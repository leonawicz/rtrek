<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Star Trek API (STAPI) • rtrek</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Star Trek API (STAPI)">
<meta property="og:description" content="rtrek">
<meta property="og:image" content="https://leonawicz.github.io/rtrek/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rtrek</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/rtrek.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stapi.html">Star Trek API (STAPI)</a>
    </li>
    <li>
      <a href="../articles/memory-alpha.html">Memory Alpha</a>
    </li>
    <li>
      <a href="../articles/memory-beta.html">Memory Beta</a>
    </li>
    <li>
      <a href="../articles/fonts.html">Star Trek fonts</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Examples</li>
    <li>
      <a href="../articles/ex-word-count.html">Novels: word count</a>
    </li>
    <li>
      <a href="../articles/ex-episode-analysis.html">Episodes: spoken lines</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/sc.html">Stellar Cartography</a>
</li>
<li>
  <a href="https://github.com/leonawicz/rtrek" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Star Trek API (STAPI)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/leonawicz/rtrek/blob/HEAD/vignettes/stapi.Rmd" class="external-link"><code>vignettes/stapi.Rmd</code></a></small>
      <div class="hidden name"><code>stapi.Rmd</code></div>

    </div>

    
    
<p>The <code>rtrek</code> package includes some Star Trek datasets, but
much more data is available outside the package. You can access other
Star Trek data through various APIs.</p>
<p>Technically, there is only one formal API: the Star Trek API (STAPI).
<code>rtrek</code> has functions to assist with making calls to this API
in order to access specific data. This is the focus of this
vignette.</p>
<p><code>rtrek</code> also interfaces with and extracts information from
the <a href="https://memory-alpha.fandom.com/wiki/Portal:Main" class="external-link">Memory
Alpha</a> and <a href="https://memory-beta.fandom.com/wiki/Main_Page" class="external-link">Memory Beta</a>
websites. Neither of these sites actually expose an API, but functions
in <code>rtrek</code> with querying these websites in an API-like
manner. See the respective vignettes for details.</p>
<p>Accessing information from STAPI is covered to some degree in the
package <a href="https://leonawicz.github.io/rtrek/articles/rtrek.html">introduction
vignette</a>. There is some duplication here, followed by additional
examples.</p>
<div class="section level2">
<h2 id="star-trek-api">Star Trek API<a class="anchor" aria-label="anchor" href="#star-trek-api"></a>
</h2>
<p>The <a href="http://stapi.co/" class="external-link">Star Trek API (STAPI)</a> is a
particularly useful data source.</p>
<p>Keep in mind that STAPI focuses more on providing real world data
associated with Star Trek (e.g., when did episode X first air on
television?) than on fictional universe data, but it contains both and
the database holdings will grow with time.</p>
<p>To use the words of the developers, the STAPI is</p>
<p><em>the first public Star Trek API, accessible via REST and SOAP.
It’s an open source project, that anyone can contribute to.</em></p>
<p>The API is highly functional. Please do not abuse the API with
constant requests. Their pages suggest no more than one request per
second, but I would suggest ten seconds between successive requests. The
default anti-DDOS measures in <code>rtrek</code> limit requests to one
per second. You can update this global <code>rtrek</code> setting with
<code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code>, e.g. <code>options(rtrek_antidos = 10)</code>
for a minimum ten second wait between API calls to be an even better
neighbor. <code>rtrek</code> will not permit faster requests. If set
below one second, the option is ignored and a warning thrown when making
any API call.</p>
<div class="section level3">
<h3 id="stapi-entities">STAPI entities<a class="anchor" aria-label="anchor" href="#stapi-entities"></a>
</h3>
<p>There a many fields, or entities, available in the API. The available
IDs can be found in this table:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stapiEntities</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 4</span></span></span>
<span><span class="co">#&gt;    id                 class   ncol colnames    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> animal             tbl_df     7 <span style="color: #949494;">&lt;chr [7]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> astronomicalObject tbl_df     5 <span style="color: #949494;">&lt;chr [5]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> book               tbl_df    24 <span style="color: #949494;">&lt;chr [24]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> bookCollection     tbl_df    10 <span style="color: #949494;">&lt;chr [10]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> bookSeries         tbl_df    11 <span style="color: #949494;">&lt;chr [11]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> character          tbl_df    24 <span style="color: #949494;">&lt;chr [24]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> comicCollection    tbl_df    14 <span style="color: #949494;">&lt;chr [14]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> comics             tbl_df    15 <span style="color: #949494;">&lt;chr [15]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> comicSeries        tbl_df    15 <span style="color: #949494;">&lt;chr [15]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> comicStrip         tbl_df    12 <span style="color: #949494;">&lt;chr [12]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more rows</span></span></span></code></pre></div>
<p>These ID values are passed to <code><a href="../reference/stapi.html">stapi()</a></code> to perform a
search using the API. The other columns provide some information about
the object returned from a search. All entity searches return tibble
data frames. You can inspect or unnest the column names of each table
returned from every available entity search so you can see beforehand
what variables are associated with each entity.</p>
</div>
<div class="section level3">
<h3 id="accessing-the-api">Accessing the API<a class="anchor" aria-label="anchor" href="#accessing-the-api"></a>
</h3>
<p>Using <code>stapi</code> should be thought of as a three part
process:</p>
<ul>
<li>Determine how many pages of results exist for a particular entity
search.</li>
<li>Only after taking care to do the previous step, perform the search
to return search results.</li>
<li>If satellite data is needed on a unique observation in the search
results, call <code><a href="../reference/stapi.html">stapi()</a></code> one more time referencing the
specific observation.</li>
</ul>
<p>To determine how many pages of results exist for a given search, set
<code>page_count = TRUE</code>. The impact on the API will be equivalent
to only searching a single page of results. One page contains metadata
including the total number of pages. Nothing is returned in this “safe
mode”, but the total number of search results available is printed to
the console.</p>
<p>Searching movies only returns one page of results. However, there are
a lot of characters in the Star Trek universe. Check the total pages
available for character search.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stapi.html">stapi</a></span><span class="op">(</span><span class="st">"character"</span>, page_count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total pages to retrieve all results: 76</span></span></code></pre></div>
<p>And that is with 100 results per page!</p>
<p>The default <code>page = 1</code> only returns the first page.
<code>page</code> can be a vector, e.g. <code>page = 1:62</code>.
Results from multi-page searches are automatically combined into a
single, constant data frame output. For the second call to
<code><a href="../reference/stapi.html">stapi()</a></code>, return only page two here, which contains the
character, Q (currently, pending future character database updates that
may shift the indexing). In case that does change and Q is not always
near the top of page two of the search results, the example further
below hard-codes his unique/universal ID.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/stapi.html">stapi</a></span><span class="op">(</span><span class="st">"character"</span>, page <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">uid</span>, <span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;    uid            name         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> CHMA0000215045 0413 Theta   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> CHMA0000174718 0718         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CHMA0000283851 10111        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> CHMA0000278055 335          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> CHMA0000282741 355          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CHMA0000026532 A'trom       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CHMA0000280385 A. Armaganian</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CHMA0000226457 A. Baiers    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> CHMA0000232390 A. Baiers    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> CHMA0000068580 A. Banda     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>Character tables can be sparse. There are a lot of variables, many of
which will contain missing data for rare, esoteric characters. Even for
more popular characters about whom much more universe lore has been
uncovered, it still takes dedicated nerds to enter all the data in a
database.</p>
<p>When a dataset contains a <code>uid</code> column, this can be used
subsequently to extract a satellite dataset about that particular
observation that was returned in the original search. First you used
safe mode, then search mode, and now switch from search mode to
extraction mode to obtain data about Q, specifically. All that is
required to do this is pass Q’s <code>uid</code> to <code><a href="../reference/stapi.html">stapi()</a></code>
and call the function one last time. When <code>uid</code> is no longer
<code>NULL</code>, <code><a href="../reference/stapi.html">stapi()</a></code> knows not to bother with a
search and makes a different type of API call requesting information
about the uniquely identified entry.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="st">"CHMA0000025118"</span></span>
<span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stapi.html">stapi</a></span><span class="op">(</span><span class="st">"character"</span>, uid <span class="op">=</span> <span class="va">Q</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q_eps</span> <span class="op">&lt;-</span> <span class="va">Q</span><span class="op">$</span><span class="va">episodes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">uid</span>, <span class="va">title</span>, <span class="va">stardateFrom</span>, <span class="va">stardateTo</span><span class="op">)</span></span>
<span><span class="va">q_eps</span></span>
<span><span class="co">#&gt;               uid                 title stardateFrom stardateTo</span></span>
<span><span class="co">#&gt; 1  EPMA0000259941               Veritas           NA         NA</span></span>
<span><span class="co">#&gt; 2  EPMA0000000651              Tapestry           NA         NA</span></span>
<span><span class="co">#&gt; 3  EPMA0000000500            Hide And Q      41590.5    41590.5</span></span>
<span><span class="co">#&gt; 4  EPMA0000277408        The Star Gazer           NA         NA</span></span>
<span><span class="co">#&gt; 5  EPMA0000280052              Farewell           NA         NA</span></span>
<span><span class="co">#&gt; 6  EPMA0000279099            Two of One           NA         NA</span></span>
<span><span class="co">#&gt; 7  EPMA0000278606               Watcher           NA         NA</span></span>
<span><span class="co">#&gt; 8  EPMA0000001510    The Q and the Grey      50384.2    50392.7</span></span>
<span><span class="co">#&gt; 9  EPMA0000001413                True Q      46192.3    46192.3</span></span>
<span><span class="co">#&gt; 10 EPMA0000000845                Q-Less      46531.2    46531.2</span></span>
<span><span class="co">#&gt; 11 EPMA0000001329                 Q Who      42761.3    42761.3</span></span>
<span><span class="co">#&gt; 12 EPMA0000278900    Fly Me to the Moon           NA         NA</span></span>
<span><span class="co">#&gt; 13 EPMA0000000483 Encounter at Farpoint      41153.7    41153.7</span></span>
<span><span class="co">#&gt; 14 EPMA0000001458    All Good Things...      47988.0    47988.0</span></span>
<span><span class="co">#&gt; 15 EPMA0000162588            Death Wish      49301.2    49301.2</span></span>
<span><span class="co">#&gt; 16 EPMA0000289337   The Last Generation           NA         NA</span></span>
<span><span class="co">#&gt; 17 EPMA0000001347                Deja Q      43539.1    43539.1</span></span>
<span><span class="co">#&gt; 18 EPMA0000277535               Penance           NA         NA</span></span>
<span><span class="co">#&gt; 19 EPMA0000278226          Assimilation           NA         NA</span></span>
<span><span class="co">#&gt; 20 EPMA0000279450                 Mercy           NA         NA</span></span>
<span><span class="co">#&gt; 21 EPMA0000001619                    Q2      54704.5    54704.5</span></span>
<span><span class="co">#&gt; 22 EPMA0000001377                  Qpid      44741.9    44741.9</span></span></code></pre></div>
<p>The data returned on Q is actually a large list, including multiple
data frames. For simplicity only a piece of it is shown above.</p>
<p>Find out which TNG characters other than Q appear in both the
<em>Encounter at Farpoint</em> series premier and later in the <em>All
Good Things…</em> series finale. To do this, use<code><a href="../reference/stapi.html">stapi()</a></code> to
extract data from other endpoints by following a breadcrumb trail of
<code>uid</code> values.</p>
<p>Engage.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Encounter at Farpoint"</span>, <span class="st">"All Good Things..."</span><span class="op">)</span></span>
<span><span class="va">q_eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">q_eps</span>, <span class="va">title</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">eps</span><span class="op">)</span></span>
<span><span class="va">q_eps</span></span>
<span><span class="co">#&gt;              uid                 title stardateFrom stardateTo</span></span>
<span><span class="co">#&gt; 1 EPMA0000000483 Encounter at Farpoint      41153.7    41153.7</span></span>
<span><span class="co">#&gt; 2 EPMA0000001458    All Good Things...      47988.0    47988.0</span></span>
<span><span class="va">eaf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stapi.html">stapi</a></span><span class="op">(</span><span class="st">"episode"</span>, uid <span class="op">=</span> <span class="va">q_eps</span><span class="op">$</span><span class="va">uid</span><span class="op">[</span><span class="va">q_eps</span><span class="op">$</span><span class="va">title</span> <span class="op">==</span> <span class="va">eps</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">agt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stapi.html">stapi</a></span><span class="op">(</span><span class="st">"episode"</span>, uid <span class="op">=</span> <span class="va">q_eps</span><span class="op">$</span><span class="va">uid</span><span class="op">[</span><span class="va">q_eps</span><span class="op">$</span><span class="va">title</span> <span class="op">==</span> <span class="va">eps</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">characters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">eaf</span><span class="op">$</span><span class="va">characters</span><span class="op">$</span><span class="va">name</span>, <span class="va">agt</span><span class="op">$</span><span class="va">characters</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>, <span class="st">"Q"</span><span class="op">)</span></span>
<span><span class="va">characters</span></span>
<span><span class="co">#&gt; [1] "Deanna Troi"      "William T. Riker" "Miles O'Brien"    "Natasha Yar"     </span></span>
<span><span class="co">#&gt; [5] "Worf"             "Geordi La Forge"  "Data"             "Jean-Luc Picard" </span></span>
<span><span class="co">#&gt; [9] "Beverly Crusher"</span></span></code></pre></div>
<p>This returns key crew members who remained a part of the show from
beginning to end, disregarding any interim absences. Below, inspect how
many episodes each character appeared in. <code>uid</code> is again
needed, this time for each character.</p>
<p>Note that this requires making one API call for each character. The
anti-DOS measures in <code>rtrek</code> will force a one-second minimum
wait between each call in the event that the individual calls actually
return results faster than this, so the code below will take at least
seven seconds to complete.</p>
<p>Add a fun Star Trek-themed plot? Make it so.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">characters</span> <span class="op">&lt;-</span> <span class="va">eaf</span><span class="op">$</span><span class="va">characters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">uid</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">characters</span><span class="op">)</span></span>
<span><span class="va">characters</span></span>
<span><span class="co">#&gt;              uid             name</span></span>
<span><span class="co">#&gt; 1 CHMA0000123101      Deanna Troi</span></span>
<span><span class="co">#&gt; 2 CHMA0000123073 William T. Riker</span></span>
<span><span class="co">#&gt; 3 CHMA0000278225    Miles O'Brien</span></span>
<span><span class="co">#&gt; 4 CHMA0000278224      Natasha Yar</span></span>
<span><span class="co">#&gt; 5 CHMA0000123141             Worf</span></span>
<span><span class="co">#&gt; 6 CHMA0000132570  Geordi La Forge</span></span>
<span><span class="co">#&gt; 7 CHMA0000261620             Data</span></span>
<span><span class="co">#&gt; 8 CHMA0000289509  Jean-Luc Picard</span></span>
<span><span class="co">#&gt; 9 CHMA0000123143  Beverly Crusher</span></span>
<span><span class="va">eps_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">characters</span><span class="op">$</span><span class="va">uid</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/stapi.html">stapi</a></span><span class="op">(</span><span class="st">"character"</span>, uid <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">episodes</span><span class="op">$</span><span class="va">series</span> <span class="op">|&gt;</span></span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">title</span> <span class="op">==</span> <span class="st">"Star Trek: The Next Generation"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">eps_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">characters</span>, <span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">eps_count</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext" class="external-link">showtext</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add.html" class="external-link">font_add</a></span><span class="op">(</span><span class="st">"StarNext"</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"fonts/StarNext.ttf"</span><span class="op">)</span>, package <span class="op">=</span> <span class="st">"trekfont"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html" class="external-link">showtext_auto</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uniforms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#5B1414"</span>, <span class="st">"#AD722C"</span>, <span class="st">"#1A6384"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">eb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">eps_count</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="va">name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">uniforms</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">22</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"StarNext"</span><span class="op">)</span>, line <span class="op">=</span> <span class="va">eb</span>, axis.text.x <span class="op">=</span> <span class="va">eb</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"TNG EPISODE APPEARANCES"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="stapi_files/figure-html/stapi_extract3-1.png" width="100%"></p>
<p>This looks as expected. Inspect the structure of the list objects
returned by <code><a href="../reference/stapi.html">stapi()</a></code> to become more familiar with what kind
of information is available.</p>
</div>
<div class="section level3">
<h3 id="minor-weirdness">Minor weirdness<a class="anchor" aria-label="anchor" href="#minor-weirdness"></a>
</h3>
<p>Sometimes you may receive errors when trying filter rows for one of
the data frames while certain problematic columns are still selected.
This is likely because the data frame contains a nested data frame, but
one which is not nested in the typical way (e.g.,
<code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">tidyr::unnest()</a></code> will also fail to resolve the issue).</p>
<p>In the code immediately above, this occurs with the
<code>series</code> data frame, which is why the <code>episodes</code>
parent data frame is subset using <code>$series</code> before calling
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise()</a></code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/leonawicz" class="external-link">Matthew Leonawicz</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
