<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Episode analysis • rtrek</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Episode analysis">
<meta property="og:description" content="rtrek">
<meta property="og:image" content="https://leonawicz.github.io/rtrek/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rtrek</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/rtrek.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stapi.html">Star Trek API (STAPI)</a>
    </li>
    <li>
      <a href="../articles/memory-alpha.html">Memory Alpha</a>
    </li>
    <li>
      <a href="../articles/memory-beta.html">Memory Beta</a>
    </li>
    <li>
      <a href="../articles/fonts.html">Star Trek fonts</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Examples</li>
    <li>
      <a href="../articles/ex-word-count.html">Novels: word count</a>
    </li>
    <li>
      <a href="../articles/ex-episode-analysis.html">Episodes: spoken lines</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/sc.html">Stellar Cartography</a>
</li>
<li>
  <a href="../articles/rr.html">R &amp; R... &amp; R</a>
</li>
<li>
  <a href="https://github.com/leonawicz/rtrek">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ex-episode-analysis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Episode analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/leonawicz/rtrek/blob/master/vignettes/ex-episode-analysis.Rmd"><code>vignettes/ex-episode-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>ex-episode-analysis.Rmd</code></div>

    </div>

    
    
<div id="importing-transcript-data" class="section level2">
<h2 class="hasAnchor">
<a href="#importing-transcript-data" class="anchor"></a>Importing transcript data</h2>
<p>A curated data frame of metadata and text variables derived from episode and movie transcripts can be downloaded with <code>st_transcripts</code>. The format is one episode per row. There are metadata columns and a list column of nested text variables.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>

<span class="op">(</span><span class="va">scriptData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_transcripts.html">st_transcripts</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 726 x 10</span>
<span class="co">#&gt;    format  series season number title   production airdate  url     url2   text </span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;lis&gt;</span>
<span class="co">#&gt;  1 episode TOS         1      0 The Ca~          1 &lt;NA&gt;     https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  2 episode TOS         1      1 The Ma~          6 1966-09~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  3 episode TOS         1      2 Charli~          8 1966-09~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  4 episode TOS         1      3 Where ~          2 1966-09~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  5 episode TOS         1      4 The Na~          7 1966-09~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  6 episode TOS         1      5 The En~          5 1966-10~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  7 episode TOS         1      6 Mudd's~          4 1966-10~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  8 episode TOS         1      7 What a~         10 1966-10~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt;  9 episode TOS         1      8 Miri            12 1966-10~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt; 10 episode TOS         1      9 Dagger~         11 1966-11~ https:~ http:~ &lt;tib~</span>
<span class="co">#&gt; # ... with 716 more rows</span>

<span class="va">scriptData</span><span class="op">$</span><span class="va">text</span><span class="op">[[</span><span class="fl">81</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; # A tibble: 816 x 6</span>
<span class="co">#&gt;    line_number perspective    setting         description character line        </span>
<span class="co">#&gt;          &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;       </span>
<span class="co">#&gt;  1          NA &lt;NA&gt;           "Fade in"       &lt;NA&gt;        &lt;NA&gt;      &lt;NA&gt;        </span>
<span class="co">#&gt;  2           1 Ext. Space - ~ "The u.s.s. En~ &lt;NA&gt;        Picard V~ Captain's l~</span>
<span class="co">#&gt;  3           2 Other introdu~ "On the gigant~ &lt;NA&gt;        Picard V~ My orders a~</span>
<span class="co">#&gt;  4           3 Int. Engine r~ "Huge, with a ~ Continuing  Picard V~ ... I am be~</span>
<span class="co">#&gt;  5           4 Closer on ves~ "Showing the d~ &lt;NA&gt;        Picard V~ I am still ~</span>
<span class="co">#&gt;  6          NA Int. Lounge d~ "With its huge~ &lt;NA&gt;        &lt;NA&gt;      &lt;NA&gt;        </span>
<span class="co">#&gt;  7           5 Continued       &lt;NA&gt;           Continuing  Picard V~ ... my crew~</span>
<span class="co">#&gt;  8           6 Int. Bridge -~ "Picard, troi,~ Continuing  Picard V~ ... a first~</span>
<span class="co">#&gt;  9           7 Angle emphasi~ "As picard tur~ &lt;NA&gt;        Picard    You will ag~</span>
<span class="co">#&gt; 10           8 Angle emphasi~  &lt;NA&gt;           &lt;NA&gt;        Data      Difficult .~</span>
<span class="co">#&gt; # ... with 806 more rows</span></code></pre></div>
</div>
<div id="basic-tng-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-tng-summary" class="anchor"></a>Basic TNG summary</h2>
<p>Consider TNG episodes. A rough estimate of the relative amount of speaking parts can be obtained by counting up the lines for each character. A better measure would be an estimate of word count taken from each spoken line. Calculate these statistics by season and episode as well as character.</p>
<p>Also remove unneeded columns. As is common in text analysis, even a clean dataset may need further preparation for a specific task. In this case it is important to strip references to things such as voice over <code>(V.o.)</code> from the <code>character</code> column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pat</span> <span class="op">&lt;-</span> <span class="st">"('s\\s|\\s\\(|\\sV\\.).*"</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">scriptData</span>, <span class="va">format</span> <span class="op">==</span> <span class="st">"episode"</span> <span class="op">&amp;</span> <span class="va">series</span> <span class="op">==</span> <span class="st">"TNG"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">title</span>, <span class="va">character</span>, <span class="va">line</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>character <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="va">pat</span>, <span class="st">""</span>, <span class="va">character</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">title</span>, <span class="va">character</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">line</span>, <span class="st">" "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">x</span>
<span class="co">#&gt; # A tibble: 2,858 x 5</span>
<span class="co">#&gt; # Groups:   season, title [176]</span>
<span class="co">#&gt;    season title    character        lines words</span>
<span class="co">#&gt;     &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1      1 11001001 Ad Libbed Voices     1    14</span>
<span class="co">#&gt;  2      1 11001001 Bass                 4    16</span>
<span class="co">#&gt;  3      1 11001001 Beverly              7   169</span>
<span class="co">#&gt;  4      1 11001001 Bynar One Zero       1     5</span>
<span class="co">#&gt;  5      1 11001001 Bynar Zero One       1     9</span>
<span class="co">#&gt;  6      1 11001001 Computer            11    96</span>
<span class="co">#&gt;  7      1 11001001 Computer Voice      14   129</span>
<span class="co">#&gt;  8      1 11001001 Data                31   361</span>
<span class="co">#&gt;  9      1 11001001 Drummer              2    22</span>
<span class="co">#&gt; 10      1 11001001 Geordi              23   166</span>
<span class="co">#&gt; # ... with 2,848 more rows</span></code></pre></div>
<p>Another limitation of using lines is that they may not always mimic the natural breaks in spoken lines in the episodes. While word count here is simply estimated by breaking text on spaces, it is likely more representative than the line count.</p>
<div id="total-spoken-words" class="section level3">
<h3 class="hasAnchor">
<a href="#total-spoken-words" class="anchor"></a>Total spoken words</h3>
<p>Next, focus on the top eight characters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">totals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">character</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span>, words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>

<span class="va">totals</span>
<span class="co">#&gt; # A tibble: 8 x 3</span>
<span class="co">#&gt;   character lines  words</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 Picard    14126 163701</span>
<span class="co">#&gt; 2 Data       7012  88573</span>
<span class="co">#&gt; 3 Riker      8284  78207</span>
<span class="co">#&gt; 4 Geordi     5095  57868</span>
<span class="co">#&gt; 5 Beverly    3740  45114</span>
<span class="co">#&gt; 6 Troi       3615  39128</span>
<span class="co">#&gt; 7 Worf       4233  36345</span>
<span class="co">#&gt; 8 Wesley     1564  14164</span></code></pre></div>
<p>By the way, look at the total estimated lines and words spoken by each character. These are of course rough estimates. Nevertheless, it is interesting to see that Picard has nearly twice as much to say as the next most talkative character on the show, the Android, Data. It must be all those impromptu diplomatic speeches.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">totals</span><span class="op">$</span><span class="va">character</span>
<span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">totals</span><span class="op">$</span><span class="va">character</span>, levels <span class="op">=</span> <span class="va">id</span><span class="op">)</span>
<span class="va">uniform_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#5B1414"</span>, <span class="st">"#AD722C"</span>, <span class="st">"#1A6384"</span><span class="op">)</span>
<span class="va">ulev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Command"</span>, <span class="st">"Operations"</span>, <span class="st">"Science"</span><span class="op">)</span>
<span class="va">uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ulev</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, levels <span class="op">=</span> <span class="va">ulev</span><span class="op">)</span>
<span class="va">totals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">totals</span>, character <span class="op">=</span> <span class="va">chr</span>, uniform <span class="op">=</span> <span class="va">uniform</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">totals</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">character</span>, <span class="va">words</span>, fill <span class="op">=</span> <span class="va">uniform</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">uniform_colors</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">words</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span>, <span class="st">"K"</span><span class="op">)</span><span class="op">)</span>, 
            size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"white"</span>, vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span></code></pre></div>
<p><img src="ex-episode-analysis_files/figure-html/ep4-1.png" width="1152"></p>
</div>
<div id="prominent-roles" class="section level3">
<h3 class="hasAnchor">
<a href="#prominent-roles" class="anchor"></a>Prominent roles</h3>
<p>What is each character’s biggest episode per season in terms of estimated spoken words?</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biggest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">character</span> <span class="op">%in%</span> <span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>character <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">character</span>, levels <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">character</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">title</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">]</span>, words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">character</span><span class="op">)</span>

<span class="va">biggest</span>
<span class="co">#&gt; # A tibble: 55 x 4</span>
<span class="co">#&gt; # Groups:   season [7]</span>
<span class="co">#&gt;    season character title                 words</span>
<span class="co">#&gt;     &lt;int&gt; &lt;fct&gt;     &lt;chr&gt;                 &lt;int&gt;</span>
<span class="co">#&gt;  1      1 Picard    Encounter at Farpoint  2575</span>
<span class="co">#&gt;  2      2 Picard    The Measure of a Man   1844</span>
<span class="co">#&gt;  3      3 Picard    The Survivors          1738</span>
<span class="co">#&gt;  4      4 Picard    Devil's Due            2095</span>
<span class="co">#&gt;  5      5 Picard    Ensign Ro              1897</span>
<span class="co">#&gt;  6      6 Picard    The Chase              2083</span>
<span class="co">#&gt;  7      7 Picard    All Good Things...     4019</span>
<span class="co">#&gt;  8      1 Data      Datalore                944</span>
<span class="co">#&gt;  9      2 Data      The Schizoid Man       1592</span>
<span class="co">#&gt; 10      3 Data      The Offspring          1886</span>
<span class="co">#&gt; # ... with 45 more rows</span>

<span class="va">biggest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">biggest</span>, winner <span class="op">=</span> <span class="va">character</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">]</span>,
                  ymn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span>, ymx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uniform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">uniform</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">biggest</span><span class="op">$</span><span class="va">character</span>, <span class="va">id</span><span class="op">)</span><span class="op">]</span>, levels <span class="op">=</span> <span class="va">ulev</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">biggest</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">words</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ymn</span>, ymax <span class="op">=</span> <span class="va">ymx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">uniform</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">uniform_colors</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">" ("</span>, <span class="va">character</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, 
                  size <span class="op">=</span> <span class="fl">2.3</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, direction <span class="op">=</span> <span class="st">"y"</span>, min.segment.length <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, labels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expand_scale</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="ex-episode-analysis_files/figure-html/ep5-1.png" width="1152"></p>
</div>
</div>
<div id="transferring-from-tng-to-ds9" class="section level2">
<h2 class="hasAnchor">
<a href="#transferring-from-tng-to-ds9" class="anchor"></a>Transferring from TNG to DS9</h2>
<p>Finally, look at both Worf and O’Brien, making a comparison between TNG and DS9 in terms of their prominence.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">scriptData</span>, <span class="va">format</span> <span class="op">==</span> <span class="st">"episode"</span> <span class="op">&amp;</span> <span class="va">series</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TNG"</span>, <span class="st">"DS9"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">series</span>, <span class="va">season</span>, <span class="va">title</span>, <span class="va">character</span>, <span class="va">line</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>character <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="va">pat</span>, <span class="st">""</span>, <span class="va">character</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">character</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Worf"</span>, <span class="st">"O'brien"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">series</span>, <span class="va">title</span>, <span class="va">character</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">line</span>, <span class="st">" "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">series</span>, <span class="va">character</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span>, words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span>, n_episodes <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">character</span>, <span class="va">series</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">avg</span><span class="op">$</span><span class="va">character</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"O'brien"</span>, <span class="st">"O'Brien"</span>, <span class="va">avg</span><span class="op">$</span><span class="va">character</span><span class="op">)</span>

<span class="va">avg</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   series character lines words n_episodes</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 DS9    O'Brien    34.5  364.        159</span>
<span class="co">#&gt; 2 TNG    O'Brien    11.6  117.         44</span>
<span class="co">#&gt; 3 DS9    Worf       22.2  227.        100</span>
<span class="co">#&gt; 4 TNG    Worf       24.2  208.        175</span>

<span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">avg</span><span class="op">$</span><span class="va">character</span><span class="op">)</span><span class="op">)</span>
<span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">avg</span><span class="op">$</span><span class="va">character</span>, levels <span class="op">=</span> <span class="va">id</span><span class="op">)</span>
<span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">avg</span>, series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">series</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TNG"</span>, <span class="st">"DS9"</span><span class="op">)</span><span class="op">)</span>, character <span class="op">=</span> <span class="va">chr</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">avg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">character</span>, <span class="va">words</span>, fill <span class="op">=</span> <span class="va">series</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dodgerblue"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">series</span>, <span class="st">": "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
            size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"white"</span>, vjust <span class="op">=</span> <span class="fl">1.5</span>, 
            position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Average words per episode"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span></code></pre></div>
<p><img src="ex-episode-analysis_files/figure-html/ep6-1.png" width="1152"></p>
<p>This is a simple exploration of the data, but the results are interesting. Starfleet promotions in rank aside, Worf did not even quite receive a 10% pay bump in terms of average spoken words per episode. On the other hand, O’Brien had an increase of 211%, or more than triple the average number of spoken words per episode when moving from the Enterprise to Deep Space Nine. All things considered, take the transfer. But on spoken words alone, O’Brien was clearly favored. The squeaky wheel gets the grease.</p>
<div id="considerations" class="section level3">
<h3 class="hasAnchor">
<a href="#considerations" class="anchor"></a>Considerations</h3>
<p>This calculation accounts for the number of episodes each character has speaking lines in. For example, TNG episodes missing O’Brien after DS9 began and DS9 episodes missing Worf before he joined the show are not counted against them.</p>
<p>It does not account for episodes where a character may appear in an episode, but without any speaking lines, which should drop their averages. However, this is rare and, if anything, I would expect it to exacerbate the difference seen here rather than diminish it. I’m just guessing there may have been some early TNG episodes where O’Brien was shown but never spoke.</p>
<p>A more rigorous approach that I may show in a subsequent example would be to join this transcript data with episode casting data from STAPI so that there is no need to rely on speaking lines in transcripts to guess at whether someone was featured in an episode.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/leonawicz">Matthew Leonawicz</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
